

## Kmom10

### Krav 1-3
För projektarbetet har jag valt att arbeta me hållbarhetsindikatorer, då jag fann att detta gav bäst möjlighet att arbeta med databaser,
ett krav för projektet och något jag gärna vill lära mig mer om. För projektet har jag valt området Hållbar konsumtion och produktion, då det är något jag själv finner är mycket viktigt och har för detta valt fyra stycker indikatorer som rör att presentera som jag tycker väl belyser området: konsumtionsbaserade utsläpp, där jag presenterar data för sverige, globalt och totalt, matsvinn där jag presenterar data för ett antal sektorer för tre år, återvinning och bortskaffning, där jag presenterar data för två olika typer av återvinning samt bortskaffning samt materialåtgång/avtryck där jag presenterar totalt fotavtryck, materialåtgång per person och per mkr bnp. För detta ändamål har jag skapat en route /proj/indikatorer/{indicator} som tar en route-parameter med indikatornamnet och som utifrån detta dynamiskt hämtar data från databasen och genererar diagram. Datan kan presenteras antingen i ett diagram eller i separata diagrammet och en boolean som avgör detta sparas tillsammans med indikatorn i databasen. För diagram har jag använt Symphony UX chartjs och jag har skapat en separat klass som sköter generering av diagram med hjälp av chartjs. Indikator-sidorna kan inte nås separat från navigationen utan man måste gå via routen /proj eller andra indikatorsior, där jag inkluderat länkar. Min aboutsida är skapad som route under /proj/about och sköts från ProjectController-klassen. Här finner man about-texten, inklusive information om ORM och ER-diagram. Längst ner finns länkar till resetsidan (/proj/reset), artikel om god kod, samt länkar till github, PhpMetrics, PhpDoc och Scrutinizer.

För databasen, om vilken ni kan läsa mer utförligt på min about-sida, har jag skapat 8 nya tabeller och återanvänder user-tabellen från kmom05, modifierad för projektetes krav på användarsida. Av dessa 8 tabeller innehåller 5 statistik, en vardera för indikatorerna, matsvinn, utsläpp, återvinning och bortskaffning samt materialåtgång, samt en för svensk demografi, vilken jag har kopplat till material-tabellen via en en-till-en relation för uträkning av materialfotavtryck per person respektive bnp. Utöver dessa tabeller har jag även en tabell för artiklar och text, med titel och innehåll, indikatorer, med titel, artikel-id, motsvarande en en-till-en-relation, route, motsvarande route-parametern för indikatorsidorna, samt en bool som avgör om data ska visas i ett eller flera diagram, en för diagram, med indikator-id motsvarande en många-till-en relation, artikel-id med en-till-en-relation samt typ som bestämmer diagramtyp. Genom kopplingar mellan indikatorer, diagramdata och artiklar, kan jag lätt hämta information från samtliga tre tabeller från ett värde, route-parametern, på indikatorsidorna. Allting gällande databasen sköts i övrigt via entities och repositories, med undantag för reset-sidan läser in och exekverar en databasdump på fil. Länken till denna sida finns på about-sidan.

För stil har jag valt att i layout inte ströva allt för långt från rapportsidan, med navigationsrad längst upp och helbredds- men nte helskärmsheader, detta då jag tyckte att detta upplägg fungerade bra mån av hur informationen organiserades. Det sagt har jag arbetat med nya typsnitt för att få en annan, mer slagkraftig känsla, med kondenserad Roboto för rubriker och vanlig roboto för övrig brödtext. Färgschemat går fortfarande i ljust, då jag anser att det passer ämnet, men jag har justerat till mer naturnära färger, med en gulvit bakgrundsfärg, blått och grönt som huvud och sekundärfärg samt orange för accentfärg. Text visas med mörkgrå färg för mjukare intryck, eller inverterat mot färgad bakgrund. Tillsammans med detta har jag för header och footer använt mig av ett vattenfärgsmönster för bakgrund, då jag ansåg att det passade det klimatnära temat. Utöver detta har jag arbetat med färgblock, ett nytt element, för att presentera information och skapa välsynliga länk-block och marginaler mot sidor har justerats för att få sidan att kännas mer samlad i sitt uttryck. Vad gäller stylesheets har jag skapat ett nya css-filer och ett nytt tema som jag sparat undan. En del css-kod har jag lånat från projektet, så som kod för navigation (varav en del kod är funktionell), samt grundläggande kod för layout, så som rad- och kolumn-klasseer.

För kodstil passerar projektet utan anmärkning genom phpcs och all egenkomponerad kod klarar sig även genom linters. Vad gäller linters har jag från phpmd fått en rad anmärkningar gällande korta variabelnamn och variabelnamn som inte är i camelcase för entity-klasserna samt booleanArgumentFlag-vargningar för repository-klasserna. PhpStan anmärker dessutom att id-egenskaper i entity-klasserna är read-only. Då alla dessa anmärkningar rör autogenerera kod, och i synnerhet i stor utsträckning rör namn som ska matcha kolumnnamn i databasen, har jag valt att inte åtgärda dessa problem och ignorera dem. Jag har även stängt av varningar för detta genom kommentarer i kod och i konfigurationsfilerna.

Vad gäller enhetstestning har jag 100% täckning på alla egenkomponerade klasser, exklusive controllerklasser. Då jag ej har skapat tester för controller-, entity- och repositoryklasser visas min kodtäckning på Scrutinizer som ca. 20% då jag ej exkluderat några mappar från src i scrutinizer-config. Det sagt når jag 100% täckning i PHP Unit för alla för projektkravet berörda klasser. Jag har för projektet skapat nya tester för metoder i min ChartCreator-klass, som dels testar att ett objekt skapas korrekt, att ett Chart-objekt returneras vid skapning och att rätt värden returneras i för chartjs rätt format från metoderna getDatasets() och getOptions, samt för min utility-klass ArrayUtil som innehåller en metod som vänder på en tvådimensionell array. Denna metod testar jag genom att kontrollera att en 2d-array returneras med rätt ordning.

Dokumentation för projektet har jag enligt instruktion genererat med hjälp av PHP-doc. Jag har skapat docblock för samtliga egenkomponerade klasser samt docblocks för samtliga egenkomponerade metoder, inklusive metoder som jag lagt till i entity-klasser. Alla docblock ska innehålla en kort beskrivning av klassen eller metoden samt relevanta parametrar och returvärden. Länken till dokumentationen kan hittas längst ner på about-sidan.

Liksom dokumentationen, kan även länkar till PhpMetrics och Scrutinizer hittas längst ner på about-sidan, tillsammans med en länk till Github-repot. Githubrepot innehåller även en readme-fil med en kort beskrivning samt badges från Scrutinizer. Vad gäller PhpMetrics och Scrutinizer har jag under projektet huvudsakligen använt PhpMetrics, då det har gått snabbare och smidigare att få fram information, medan jag stundtals upplevde ganska stora problem med scrutinizer gällande rättigheter, sökvägar och problem att bygga det klonade projektet. Detta lyckades jag till slut lösa genom att experimentera mig fram och flytta filer. När det kommer till analyserna är det huvudsakliga mätvärdet jag gått efter komplexitet. Detta då det är ett område där jag kan åstadkomma konkreta förbättringar genom att eliminera loopar och villkorssatser där de inte är absolut nödvändiga och ev. flytta ut kod, som i fallet med ChartCreator- och ArrayUtil-klasserna. Då jag huvudsakligen jobbade med controller fann jag att det var svårt att åtgärda problem med höga LCOM-tal och många kopplingar, pga controllerklassernas natur - de samlar en rad route-metoder som var och en har sina egna behov och gör sin egen sak. Jag diskuterar detta utförligare på min about sida. Va gäller mätvärden lyckades jag förbättra komplexitet för user- och projectcontrollerklasserna som jag huvudsakligen arbetat med genom att jobba med att eliminera beslutspunkter, men även genom att dela upp klasserna i två klasser vardera, en vardera för get och post för UserController samt en controller för reset-sidan och en för resterande sidor för projectcontrollern. På scrutinizer fick jag ett samlat betyg på 9.99, en liten minskning från 10 poäng under kmom10. Notera vidare att scrutinizers värde för täckning på 20% även inkluderar entity- repository samt controllerklasser.

### Krav 4
För krav fyra har jag skrivit en artikel som kan hittas på routen "/proj/cleancode". En länk finns även längst ner på about-sidan. Om denna artikel och mina tankar läser ni bäst på sidan i fråga, men kortfattat kan jag summera mina tankar kring att jag finner att de fyra c:na, coverage, complexity, cohesion och coupling är värdefulla indikatorer och PhpMetrics och Scrutinizer är bra verktyg för att identifiera problem för en kodbas på makronivå. Här handlar det om att arbeta med struktur, och dessa indikatorer kan absolut peka på bra eller dålig kod. Vidare skriver jag om att linters är värdefulla verktyg på mikronivå och att det är viktigt att anstränga sig vad gäller att följa stilregler, trots att man kanske inte håller med dem, då man som programmerare ofta inte jobbar i ett vakum.

### Krav 5
För krav 5 har jag arbetat vidare på användar/login-sidan som jag arbetae med under som extrauppgift under kmom05. Jag lade då aldrig till någon specifik admin-funktionalitet, som jag lagt till nu. Personer med icke admin-behörighet kan skapa ny användare, med akronym, epost, lösenord och bildlänk, logga in samt ändra på sina uppgifter och ta bort sitt konto, medan användare med admin-behörighet när de loggar in göra dels detta, men även ser en lista på användare för vilka de kan redigera uppgifter och/eller radera konto. Adminanvändare kan till skillnad från vanliga användare även ändra på användartyp, dvs admin eller vanlig användare. Vid skapande av hemsida sker en kontroll för existerande användare och epostadresser, i vilket fall användare retureneras till loginsidan med ett flash-meddelande och ingen användare skapas. Användare kan välja att lägga till en bildlänk, men om de inte gör det skaps en gravitar från deras epostadress. Vid uppdatering och radering måste användaren skriva in sitt nuvarande lösenord om de vill utföra åtgärden. Detta gäller även för admin om de vill redigera andra personers konton. Jag har utöver detta sett till att länken till sidan i navigationen skiftar från login till användare och vice versa beroende på inloggningsstatus, som jag hämtar i från sessionen i controllern. Användarsidorna kunde tidigare nås från rapportsidan, men jag har, då de    t var ett krav för projektarbetet flyttat länken till navigationen i projektsidan.

### Krav 6
Sist men inte minst har jag för krav 6 gett mig på att arbeta med tabellrelationer genom doctrine och ORM. Jag har 5 tabeller som är kopplade till varandra på olika sätt. Chartdata, med information om diagram, har en en-till-en relation till article, som innehåller texter och en många-till en relation till indicator, som innehåller information om indikatorerna. Även indicator har en en-till-en relation till article. Utöver detta har tabellen material en en-till-en relation till tabellen demographics, vilket används för att genom metoder i materials Entity-klass räkna ut vären för materialfotavtryck per capita och mkr gdp. Relationerna mellan indicator, article och chartdata används huvudsakligen på sidoran för indikatorerna där diagram visas. När användare skickas till indikator-routen skickas en route-parameter med med namnet på indikatorn. Denna routeparameter används sedan för att hitta rätt indikatorentity via ett repository och därifrån kan jag hitta all relevant information, den allmänna artikeln om indikatorn, diagramdata samt via chartdata-entityn dess motsvarande artiklar. Dessa relationer har jag först konfigurerat med make:entity-kommandot och inom controller-metoderna använder jag huvudsakligen de genererade metoderna i entity-klasserna. Jag funderade på att använda mig av att använda mig av join i en specialskriven repository-metod med insåg att detta skulle vara svårt då jag på grund av indikatorsiddornas dynamiska natur behövde använda mig av generiska metoder tillämpliga på alla entities. Mer information och relationer och databasen kan ni läsa på min about-sida, där jag även listar tabellerna och har inkluderat ett er-diagram.

### Allmänt om projektet
Vad gäller projektet i allmänhet var det inte nödvändigtvis kodandet som jag hade störst problem med, det kände jag gick relativt smidigt, utan istället att få alla verktyg och beroenden att fungera som de skulle. Chartjs spenderade jag nog en dag på att få rätt, då jag hade problem med js-beroenden, npm- och yarn som inte ville fungera, oförklarliga rättighets- och konfigurationsproblem, public/build-mapp som inte ville laddas upp till studentservern och så vidare. Just detta problem löste jag till sist genom att köra npm run build via windows cmd istället för cygwin. På samma sätt ställe scrutinizer till med problem och jag hade stora problem att få projektet att byggas och php-unit att köras. Jag önskar att jag kommer ihåg lösningen på detta problem, men kan ärligen inte minnas. Utöver detta gick kodandet desto bättre, jag lyckades med att bygga all funktionalitet som jag ville ha den, och jag är nöjd med min indikatorsida där jag genom databasrelationer dynamiskt kan hämta all nödvändig data och bygga diagram. Jag känner också att jag fått bättre vana vid att använda analysverktygen, och kommer gärna även göra så framöver.
Vad gäller svårighetsgrad på projektet gick de moment som vi redan arbetat med under kursen relativt smidigt och bra, även om jag gärna hade arbetat mer på min kodstruktur. De största svårigheterna upplevde jag som sagt med att försöka lösa installation och ordna beroenden för chartjs och med att få scrutinizer att fungera igen. Det sagt kändes det bra att få lösa problem och hitta nödvändig information på egen hand bra, och det är en viktig lärdom för framtida projekt. Jag kände överlag att projektet var rimligt för kursen.

Vad gäller kursen överlag kände jag att innehållet var bra, relevant och en bra sammanfattning av vad vi lärt oss under det gångna året. Samtliga moment har vi berört i någon omfattning i tidigare kurser, men det kändes bra att sammanfatta dem. Gällande handledningen har den i jämförelse med tidigar kurser varit lite knapphändig, men jag känner att det inte nödvändigtvis är ett ont, och kanske till och med avsiktligt. Att vara verksam som programmerare kräver att man kan hitta information på egen han genom referensmateral och internetsökningar, och det kändes bra att arbeta något mer självständigt. Jag har utöver det som sagt inga specifika förbättringsförlag, är överlag nöjd med kursen och skulle ge den ett betyg på 8 av 10. Jag skulle gärna rekommendera kursen som ett avslut på ett första år vid BTH.